\documentclass{beamer}
\usetheme{Darmstadt}
\usefonttheme[onlylarge]{structurebold}
\setbeamerfont*{frametitle}{size=\normalsize,series=\bfseries}
\setbeamertemplate{navigation symbols}{}
\usepackage{tikz}
\usepackage{circuitikz}
\usepackage[english]{babel}
\usepackage[latin1]{inputenc}
\usepackage{times}
\usepackage[T1]{fontenc}

\usepackage{pgfplots}
\usepackage[makeroom]{cancel}
\usepackage{hyperref}
\usetikzlibrary{arrows}
\tikzstyle{block}=[draw opacity=0.7,line width=1.4cm]
\usetikzlibrary{arrows,positioning}
%\PreviewEnvironment{tikzpicture}


\def\ground{%
    -- +(0mm,-7.0mm) {
        [yshift=-7mm]
        +(-2mm,0mm) -- +(2mm,0mm)
                +(-1mm,-1mm) -- +(1mm,-1mm)
                +(-0.3mm,-2mm) -- +(0.3mm,-2mm)
        }
}

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}
\title[Pesquisa Operacional - Problema da Corrente de Equilíbrio]
{
  Pesquisa Operacional - Problema da Corrente de Equilíbrio
}
\author[Eduardo, Manassés, Marzo, Thiago]
{
  Eduardo~César\inst{1} \and
  Manassés~Ferreira\inst{1} \and
  Marzo~Júnior\inst{1} \and
  Thiago~Linke\inst{1} \and
}
\institute[UFMG]
{
  \inst{1}
  Universidade Federal de Minas Gerais, Brasil
}
\date[PO 2013]
{Pesquisa Operacional, 2013}

\begin{document}
\begin{frame}
  \titlepage
\end{frame}
\begin{frame}{Resumo}
  \tableofcontents
\end{frame}
\section{Modelagem}
  \subsection{O Problema}
  \begin{frame}{Determinação da corrente de equilíbrio}
    Deseja-se determinar a corrente de equilíbrio que flui em um circuito elétrico como por exemplo:

  %% \end{frame}
  %% \begin{frame}{Circuito}
    \centering
    \begin{circuitikz}[nodestyle/.style={circle,draw, fill=gray!50}, corrente/.style={very thick, shorten <= 4pt, shorten >= 4pt}, scale=0.85]

      % Nodos
      \foreach \pos / \nome in {
        {(0,3)/1},  
        {(2,6)/2},
        {(2,0)/3},
        {(8,6)/4},
        {(8,0)/5},
        {(10,3)/6},
        {(5,3)/7}}
      \node[style=nodestyle]
          (\nome) at \pos {$\nome$};
          
          % Resistores
          \foreach \from / \to in {2/3,2/7,2/4,5/3,5/7,5/4,3/7,4/7}
          \draw (\from) node[style=nodestyle] {\from} to [R,l=$R_{\from\to}$] (\to) node[style=nodestyle] {\to};
          
          % Fios
          \foreach \from / \to in {1/2,1/3,4/6,5/6}
          \draw (\from) node {\from} to (\to) node {\to};
          
          % Correntes
          \node[above=of 1] {10}
          edge [corrente,->] (1);
          
          \node[above=of 6] {5}
          edge [corrente,->] (6);
          
          \node[above=of 7] {15}
          edge [corrente,<-] (7);
          
          % Terra
          \draw [thick] (7) \ground;
          
          
    \end{circuitikz}
    
  \end{frame}

  \subsection{O Modelo}
  \begin{frame}{Modelos}
    Existe mais de uma forma de se resolver o este problema. Três dessas formas serão mostradas aqui:


    \begin{enumerate}
      \item
        Modelagem como sistema de equações lineares.
      \item
        Modelagem com sistema quadrático
      \item
        Modelagem como fluxo em redes com custo convexo.

    \end{enumerate}


  \end{frame}

  \begin{frame}[t]{Modelagem como sistema linear}
    \begin{itemize}
      \item
        Problema é resolvido introduzindo-se uma variável $x_{ij}$ representando o fluxo de corrente no arco($i$, $j$) do circuito elétrico e montar um sistema de equações de equilíbrio para estes fluxos. A solução para este sistema fornece a intensidade $x_{ij}$ para cada arco respectivo.

      \item
        Baseia-se nos príncipios físicos:
        \begin{itemize}
        \item
          Lei de Ohm  $\longrightarrow V = R \times I$
         
        \item
          $1^a$ Lei de Kirchhof $\longrightarrow I_1 = I_2 + I_3$
          
        \end{itemize}

    \end{itemize}
 
  \end{frame}

  \begin{frame}[t]{Modelagem como fluxo em redes com custo convexo}
    %Modelagem como fluxo em redes com custo convexo. % Está certo isso?
    Esta formulação se utiliza de um comportamento conhecido de que as
    correntes de equilíbrio nos resistores são os fluxos para qual os
    resistores dissipam a menor potência total suprida pelas fonte de
    tensão (ou seja, a corrente elétrica segue o caminho de menor
    resistência.)

    \begin{equation*}
     \textrm{Minimizar  } \sum_{(i,j) \in A} r_{ij}x_{ij}^2 \hspace{1.5cm} \textrm{sujeito a}
    \end{equation*}

    \begin{equation*}
     \sum_{j:(i,j) \in A} x_{ij} - \sum_{i:(j,i) \in A} x_{ji} = b_{i} \hspace{1.5cm} \textrm{para cada nodo } i \in N,
    \end{equation*}

    \begin{equation*}
     x_{ij} \geq 0 \hspace{1.5cm} \textrm{para cada arco } (i,j) \in A.
    \end{equation*}



  \end{frame}

  \begin{frame}{Linearização do custo convexo}
    Aproximação por segmentação:
    \begin{itemize}
      \item
        Cada custo de arco $C_{ij}(x_{ij})$ possui $p$ segmentos
        lineares: $0 = d_{ij}^0 < d_{ij}^1 < d_{ij}^2 < d_{ij} < ...$,
        que denotam os pontos onde a função ``quebra''.
      \item
        custo varia linearmente no intervalo $[d_{ij}^{k-1},
          d_{ij}^k]$. Denotamos $c_{ij}^k$ como o coeficiente de custo
        linear no intervalo $[d_{ij}^{k-1}, d_{ij}^k]$.
      \item
        Sendo assim, para especificar o a função aproximada,
        precisamos especificar os segmentos e a inclinação da função
        nesses segmentos.

    \end{itemize}
  \end{frame}

  \begin{frame}{Linearização do custo convexo}
      \begin{tabular}{cc}
        Função $x^2$ & Segmentação linear \\
        
        \begin{tikzpicture}[scale=0.6]
          \begin{axis}[
              xlabel=$x_{ij}\longrightarrow $,
              ylabel=$C_{ij}(x_{ij})\longrightarrow$]
            \addplot[smooth,mark=*,black] plot coordinates {
              (0,0)
              (1,1)
              (2,4)
              (3,9)
              (4,16)
 %             (5,25)
            };

          \end{axis}
        \end{tikzpicture}

        &

        \begin{tikzpicture}[scale=0.6]
          \begin{axis}[
              xlabel=$x_{ij}\longrightarrow$,
              ylabel=$C_{ij}(x_{ij})\longrightarrow$]
            \addplot[mark=*,blue] plot coordinates {
              (0,0)
              (1,1)
              (2,4)
              (3,9)
              (4,16)
%              (5,25)
            };
          \end{axis}
        \end{tikzpicture}
            
      \end{tabular}

  
  \end{frame}

  \begin{frame}{Linearização do custo convexo}
      \begin{tabular}{cc}
        Função $x^2$ & Segmentação linear \\
        
        \begin{tikzpicture}[scale=0.6]
          \begin{axis}[
              xlabel=$x_{ij}\longrightarrow $,
              ylabel=$C_{ij}(x_{ij})\longrightarrow$]
            \addplot[smooth,mark=*,black] plot coordinates {
              (0,0)
              (1,1)
              (2,4)
              (3,9)
              (4,16)
              (5,25)
              (6,36)
              (7,49)
              (8,64)
              (9,81)
              (10,100)
            };

          \end{axis}
        \end{tikzpicture}

        &

        \begin{tikzpicture}[scale=0.6]
          \begin{axis}[
              xlabel=$x_{ij}\longrightarrow$,
              ylabel=$C_{ij}(x_{ij})\longrightarrow$]
            \addplot[mark=*,blue] plot coordinates {
              (0,0)
              (1,1)
              (2,4)
              (3,9)
              (4,16)
              (5,25)
              (6,36)
              (7,49)
              (8,64)
              (9,81)
              (10,100)

            };
          \end{axis}
        \end{tikzpicture}
            
      \end{tabular}

  
  \end{frame}



  \begin{frame}{Linearização do custo convexo}

    
    %% \begin{circuitikz}[scale=0.6,nodestyle/.style={circle,draw, fill=gray!50}, corrente/.style={very thick, shorten <= 4pt, shorten >= 4pt}]

    %%   \node (i) at (0,0) {i};
    %%   \node (j) at (4,0) {j};

    %%   \draw (i) node[style=nodestyle] {i} to (j) node[style=nodestyle] {j};

          
    %% \end{circuitikz}
Arco original e arcos correspondentes na nova rede:
\centering
\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=7cm,
  thick,main node/.style={circle,fill=gray!50,draw,font=\sffamily\Large\bfseries}]

  \node[main node] (1) {i};
  \node[main node] (2) [right of=1] {j};
  %% \node[main node] (3) [below of=1] {i};
  %% \node[main node] (4) [below of=2] {j};

  \path[every node/.style={font=\sffamily\small}]
    (1) edge node {$C_{ij}(x_{ij})$} (2);

  %% \path[every node/.style={font=\sffamily\small}]
  %%   (3) edge [bend left] node {$(c_{ij}^1,0,d_{ij}^1 - d_{ij}^0)$} (4)
  %%       edge node {$(c_{ij}^2,0,d_{ij}^2 - d_{ij}^1)$} (4)
  %%       edge [bend right] node {$(c_{ij}^n,0,d_{ij}^n - d_{ij}^{n-1})$} (4);
\end{tikzpicture}

\centering
\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=7cm,
  thick,main node/.style={circle,fill=gray!50,draw,font=\sffamily\Large\bfseries}]

  %% \node[main node] (1) {i};
  %% \node[main node] (2) [right of=1] {j};
  \node[main node] (3) [below of=1] {i};
  \node[main node] (4) [below of=2] {j};

  %% \path[every node/.style={font=\sffamily\small}]
  %%   (1) edge node {$C_{ij}(x_{ij})$} (2);

  \path[every node/.style={font=\sffamily\small}]
    (3) edge [bend left] node {$(c_{ij}^1,0,d_{ij}^1 - d_{ij}^0)$} (4)
        edge node {$(c_{ij}^2,0,d_{ij}^2 - d_{ij}^1)$} (4)
        edge [bend right] node {$(c_{ij}^n,0,d_{ij}^n - d_{ij}^{n-1})$} (4);
\end{tikzpicture}

      %% \begin{tabular}{cc}

      %%   Arco original $x^2$ & Arcos correspondentes \\

      %%   &

      %% \end{tabular}
    

  \end{frame}

  \begin{frame}{Linearização do custo convexo}
    \centering
    \begin{circuitikz}[nodestyle/.style={circle,draw, fill=gray!50}, corrente/.style={very thick, shorten <= 4pt, shorten >= 4pt}, scale=0.95]

      % Nodos
      \foreach \pos / \nome in {
        {(0,3)/1},  
        {(2,6)/2},
        {(2,0)/3},
        {(8,6)/4},
        {(8,0)/5},
        {(10,3)/6},
        {(5,3)/7}}
      \node[style=nodestyle]
      (\nome) at \pos {$\nome$};

          % Fios
          \foreach \from / \to in {1/2,1/3,4/6,5/6}
          \path[every node/.style={font=\sffamily\small}]
          (\from) edge node {} (\to);

          % Resistores
          \foreach \from / \to in {2/3,2/7,2/4,5/3,5/7,5/4,3/7,4/7}
          \path[every node/.style={font=\sffamily\small}]
    (\from) edge [bend left] node {} (\to)
        edge node {} (\to)
        edge [bend right] node {} (\to);


    \end{circuitikz}
  \end{frame}

  \section{Resolução}

  \subsection{Resolução sistema quadrático}

  \begin{frame}{Sistema quadrático}
    \begin{itemize}[<+->]
      \item
        Problema 1: GLPK não resolve funções objetivo que não sejam lineares
      \item
        Solução: O GNU Octave tem um solver para programação linear quadrática
      \item
        Problema 2: GNU Octave não aceita GMPL
      \item
        Solução: Programa simples converte grafo de entrada para entrada do GNU Octave
        
    \end{itemize}
  \end{frame}

  \begin{frame}{Sistema quadrático}
    \begin{itemize}[<+->]
      \item
        Para tornar as matrizes mais compactas, vamos usar uma representação baseada em arestas presentes no grafo
      \item
        Para tal, vamos definir um mapa $F:A \longrightarrow I \subset \mathbb{N}$ que mapeia arestas em números
      \item
        Definindo uma ordem total nas arestas e preservando a ordem por $F$ garante conversão e inversão fáceis
    \end{itemize}
  \end{frame}

  \begin{frame}{Sistema quadrático}
    \begin{itemize}[<+->]
      \item
        Em termos de $F[(i,j)]$ com $(i,j) \in A$, temos:
    \begin{equation*}
      r_{ij} \longrightarrow H_{ab}
    \end{equation*}
Tal que
    \begin{equation*}
      H_{ab} = 0 \hspace {1.5cm} a \neq b
    \end{equation*}

    \begin{equation*}
      H_{F[(i,j)],F[(i,j)]} = r_{ij} \hspace {1.5cm} \textrm{caso contrário}
    \end{equation*}
      \item

    \begin{equation*}
      A_{i,F[(i,j)]} = 1 \hspace {1.5cm} \forall i,j : (i,j) \in A
    \end{equation*}

    \begin{equation*}
      A_{i,F[(i,j)]} = -1 \hspace {1.5cm} \forall i,j : (j,i) \in A
    \end{equation*}

    \begin{equation*}
      A_{a,b} = 0 \hspace {1.5cm} \textrm{Caso contrário}
    \end{equation*}

    \end{itemize}
  \end{frame}

  \begin{frame}{Sistema quadrático}

    Tendo uma conversão organizada e codificada em um programa, podemos usar o GNU Octave para resolver o sistema quadrático.

  \end{frame}


  \subsection{Resolução Fluxo em Redes}
  \begin{frame}{Resolução Fluxo em Redes}
    \centering
    Tabela de segmentação dos fluxos
    \\


    \input{tabela1.tex}
    %% \begin{figure}[h!]
    %%   \centering
    %%     \includegraphics[width=1.0\textwidth]{img/compara.png}
    %% \end{figure}
  \end{frame}

%http://en.wikibooks.org/wiki/GLPK/Modeling_tips  
%In terms of relative complexity, one user reports (April 2011) that, 
%in round terms, out-of-kilter runs about 5 times faster than simplex, 
%for the same problem, and uses 2/3 the memory.

\section{Conclusões}
  \begin{frame}
    \frametitle<presentation>{Conclusões}
    \begin{itemize}[<+->]
      \item
        O algoritmo em redes é mais eficiente que a resolução em
        sistemas de equações lineares.         % Certo? Certo?!
        % Porque explora a modelagem em redes do problema, porém passa a ser menos geral.

      \item
        O equilíbrio está associado à condição de optimalidade do
        problema linear associado.
        
    \end{itemize}


  \end{frame}

  \begin{frame}{Dúvidas}
    \begin{figure}[h!]
      \centering
        \includegraphics[width=1.0\textwidth]{img/nerd_sniping.png}
    \end{figure}
  \end{frame}



%%   \begin{frame}{}
%%     Apresentação produzida usando
%%     \begin{figure}[h!]
%%       \centering
%%         \includegraphics[width=0.5\textwidth]{img/latex.png}
%%     \end{figure}
%%     disponível em \href{https://github.com/mfer/electrical-networks}{goo.gl/1DtLf}
%%   \end{frame}

\end{document}
